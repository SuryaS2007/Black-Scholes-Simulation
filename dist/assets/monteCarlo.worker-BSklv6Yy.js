function d(t){if(t>8)return 1;if(t<-8)return 0;const s=.254829592,o=-.284496736,r=1.421413741,i=-1.453152027,n=1.061405429,e=.3275911,c=t<0?-1:1,h=Math.abs(t)/Math.SQRT2,l=1/(1+e*h),p=1-((((n*l+i)*l+r)*l+o)*l+s)*l*Math.exp(-h*h);return .5*(1+c*p)}function C(t){const{S:s,K:o,T:r,r:i,sigma:n}=t,e=Math.sqrt(r),c=(Math.log(s/o)+(i+.5*n*n)*r)/(n*e),h=c-n*e;return{d1:c,d2:h}}function q(t){const{S:s,K:o,T:r,r:i}=t;if(r<=0)return{call:Math.max(s-o,0),put:Math.max(o-s,0),d1:0,d2:0};const{d1:n,d2:e}=C(t),c=Math.exp(-i*r);return{call:s*d(n)-o*c*d(e),put:o*c*d(-e)-s*d(-n),d1:n,d2:e}}function N(t){return q(t).call}function j(t){return q(t).put}function A(){let t=0,s=0;for(;t===0;)t=Math.random();for(;s===0;)s=Math.random();return Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*s)}self.onmessage=t=>{const{S:s,K:o,T:r,r:i,sigma:n,optionType:e,N:c,steps:h}=t.data,l=r/h,p=(i-.5*n*n)*l,S=n*Math.sqrt(l),f=new Array(c),P=[],m=Math.min(300,c);for(let a=0;a<c;a++){let u=s;const x=a<m?[s]:[];for(let T=0;T<h;T++)u=u*Math.exp(p+S*A()),a<m&&x.push(u);f[a]=u,a<m&&P.push(x)}const b=e==="call"?f.map(a=>Math.max(a-o,0)):f.map(a=>Math.max(o-a,0)),w=Math.exp(-i*r),g=b.map(a=>a*w),M=g.reduce((a,u)=>a+u,0)/c,D=g.reduce((a,u)=>a+(u-M)**2,0)/(c-1),y=Math.sqrt(D/c),K=e==="call"?N({S:s,K:o,T:r,r:i,sigma:n}):j({S:s,K:o,T:r,r:i,sigma:n}),v={displayPaths:P,terminalPrices:f,mcPrice:M,ciLow:M-1.96*y,ciHigh:M+1.96*y,bsPrice:K};self.postMessage(v)};
